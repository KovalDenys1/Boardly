name: Keep Socket Server Alive

on:
  schedule:
    # Run every hour (instead of every 10 minutes to reduce noise)
    - cron: '0 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    # Don't send notifications on failure (reduce spam)
    continue-on-error: true
    
    steps:
      - name: Ping Socket Server
        # Don't fail the workflow if curl fails
        continue-on-error: true
        run: |
          echo "Pinging socket server at $(date)"
          
          # Ping with timeout and retry
          for i in 1 2 3; do
            echo "Attempt $i of 3..."
            
            HTTP_CODE=$(curl -f -s -o /dev/null -w "%{http_code}" \
              --max-time 30 \
              --connect-timeout 10 \
              https://boardly-websocket.onrender.com/health)
            
            if [ "$HTTP_CODE" = "200" ]; then
              echo "✅ Socket server is alive (HTTP $HTTP_CODE)"
              exit 0
            else
              echo "⚠️ Attempt $i failed (HTTP $HTTP_CODE)"
              
              # Wait before retry (except on last attempt)
              if [ $i -lt 3 ]; then
                echo "Waiting 10 seconds before retry..."
                sleep 10
              fi
            fi
          done
          
          echo "❌ All attempts failed, but not failing workflow to avoid spam"
          echo "Socket server might be cold starting (Render free tier)"
          exit 0  # Exit successfully to avoid GitHub notifications

